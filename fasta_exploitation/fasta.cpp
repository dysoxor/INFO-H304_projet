#include "fasta.h"

// The purpose of this is to read fasta file (database or query file) and it stocks
// the name and content of the sequences into a chained list
pair< string, string > readFasta(string fichier){
  ifstream input(fichier);
  string line, name, content;

  //creating the chained list
  Liste* listeProtein = new Liste();

  //If it is not able to open the file it returns error and in the main it exits
  // on failure
  if(!input.good()){
    return {"error", "error"};
  }else{
    //while it not in end of file it read the line
    while( getline( input, line ).good() ){
        //in fasta the symbol '>' precedes the name and nexts lines are the sequences
        // of it
        if( line[0] == '>' ){
          if(!name.empty()){
            // it insert the last protein that it read into the list before starting
            // to read the next one
            listeProtein->insere(name, content);
            content = "";
          }
          name = line.substr(1);
        } else if( !name.empty() ){
          content+=line;
        }
    }
    // it inserts the last protein of fasta file that it read because it is not
    // covered by the loop above
    if ( listeProtein->getNombreProtein() > 1 )
      listeProtein->insere(name, content);
    // the following commented line prints all the fasta file from list that it
    // just built
    listeProtein->imprimeListe();
    return {name, content};
  }
}
// Constructor of an item contained in the List
Protein::Protein(string n, string s){
  name = n;
  sequence = s;
  suivant = NULL;
}
// the list has an order so each protein keep in memory the pointer of the following
// protein
void Protein::setSuivant(Protein* s){
  suivant = s;
}

Protein* Protein::getSuivant() const{
  return suivant;
}
// name of the protein
string Protein::getName() const{
  return name;
}
// sequence of the protein
string Protein::getSeqence() const{
  return sequence;
}
// initialization of the chained list
Liste::Liste(){
  nombreProtein = 0;
  tete = NULL;
}
// destructor of the chained list
Liste::~Liste(){
  while (tete != NULL)
    supprime();
}
// insert a new protein on the first place of the list
void Liste::insere(string n, string s){
  Protein* p = new Protein(n, s);
  p->setSuivant(tete);
  tete=p;
  nombreProtein++;
}
// free the memory used by the first item of the list
void Liste::supprime(){
  Protein* t = tete;
  // set the following protein as the first item of the list
  tete = tete->getSuivant();
  delete t;
  nombreProtein--;
}
// print the list
void Liste::imprimeListe(){
  Protein* t = tete;
  for(int i = 0; i < nombreProtein; i++){
    cout << i << "name:  " << t->getName() << endl;
    cout << "sequence:  " << t->getSeqence() << endl;
    t = t->getSuivant();
  }
}
// quantity of protein
int Liste::getNombreProtein() const{
  return nombreProtein;
}
// first protein in the list
Protein* Liste::getTete(){
  return tete;
}
